# Default values for cloudflare-tunnel-gateway-controller.

# -- Cloudflare configuration
cloudflare:
  # -- Cloudflare Tunnel ID (REQUIRED at install time - must not be empty)
  # Get from: Zero Trust Dashboard > Networks > Tunnels
  # Example: "550e8400-e29b-41d4-a716-446655440000" or "my-tunnel-abc-123"
  tunnelId: ""

  # -- Cloudflare Account ID (auto-detected if not specified)
  accountId: ""

  # -- Cloudflare API token with Tunnel permissions (REQUIRED unless apiTokenSecretName is set)
  # Required scopes: Account.Cloudflare Tunnel:Edit, Zone.DNS:Edit
  # Leave empty if using apiTokenSecretName for external secret
  apiToken: ""

  # -- Existing secret name containing API token (key: api-token)
  # If set, apiToken value is ignored
  # Use this for external secret management (e.g., External Secrets Operator)
  apiTokenSecretName: ""

# -- Controller configuration
controller:
  # -- GatewayClass name to watch
  gatewayClassName: "cloudflare-tunnel"
  # -- Controller name for GatewayClass (must be unique in cluster)
  controllerName: "cloudflare.com/tunnel-controller"
  # -- Kubernetes cluster domain for service DNS resolution
  clusterDomain: "cluster.local"
  # -- Log level (debug, info, warn, error)
  logLevel: "info"
  # -- Log format (json, text)
  logFormat: "json"

# -- Cloudflared deployment management via Helm
manageCloudflared:
  # -- Deploy and manage cloudflared via Helm
  enabled: false
  # -- Tunnel token for remote-managed mode
  # Get from: Zero Trust Dashboard > Networks > Tunnels > Configure
  tunnelToken: ""
  # -- Existing secret name containing tunnel token (key: tunnel-token)
  tunnelTokenSecretName: ""
  # -- Namespace for cloudflared deployment
  namespace: "cloudflare-tunnel-system"
  # -- Transport protocol (auto, quic, http2)
  protocol: ""

# -- AmneziaWG sidecar configuration for traffic routing through VPN
awg:
  # -- Secret name containing AWG config (enables AWG sidecar)
  secretName: ""
  # -- AWG interface name (unique to avoid conflicts)
  interfaceName: "awg-cfd-gw-ctrl0"

# -- Container image configuration
image:
  # -- Image repository
  repository: ghcr.io/lexfrei/cloudflare-tunnel-gateway-controller
  # -- Image pull policy
  pullPolicy: IfNotPresent
  # -- Image tag (defaults to appVersion)
  tag: ""

# -- Image pull secrets for private registries
imagePullSecrets: []

# -- Override the chart name
nameOverride: ""

# -- Override the full release name
fullnameOverride: ""

# -- Service account configuration
serviceAccount:
  # -- Annotations to add to the service account
  annotations: {}
  # -- The name of the service account to use
  # If not set, a name is generated using the fullname template
  name: ""

# -- Annotations to add to pods
podAnnotations: {}

# -- Additional labels to add to pods
podLabels: {}

# -- Pod security context (secure defaults)
# @default -- See values.yaml
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 65534
  seccompProfile:
    type: RuntimeDefault

# -- Container security context (secure defaults)
# @default -- See values.yaml
securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
      - ALL
  readOnlyRootFilesystem: true

# -- Container resource requests and limits
# @default -- See values.yaml for recommended production defaults
# When resources is empty ({}), the chart will use recommended defaults.
# Specify explicit values to override defaults.
resources:
  # Recommended resource limits for production
  # Can be overridden for specific environments
  limits:
    cpu: 200m
    memory: 256Mi
  requests:
    cpu: 100m
    memory: 128Mi

# -- Node selector for pod scheduling
nodeSelector: {}

# -- Tolerations for pod scheduling
tolerations: []

# -- Affinity rules for pod scheduling
affinity: {}

# -- Topology spread constraints for pod distribution
topologySpreadConstraints: []

# -- Priority class name for pod scheduling priority
priorityClassName: ""

# -- Termination grace period in seconds for graceful shutdown
terminationGracePeriodSeconds: 30

# -- Number of controller replicas
replicaCount: 1

# -- PodDisruptionBudget configuration for high availability
podDisruptionBudget:
  # -- Enable PodDisruptionBudget
  enabled: false
  # -- Minimum number of available pods during disruptions
  # Must not be used together with maxUnavailable
  minAvailable: 1
  # -- Maximum number of unavailable pods during disruptions
  # Must not be used together with minAvailable
  maxUnavailable: null
  # -- Policy for evicting unhealthy pods (IfHealthyBudget, AlwaysAllow)
  # Requires Kubernetes 1.26+
  unhealthyPodEvictionPolicy: "IfHealthyBudget"

# -- Service configuration
service:
  # -- Service type
  type: ClusterIP
  # -- Metrics endpoint port
  metricsPort: 8080
  # -- Health check endpoint port
  healthPort: 8081

# -- ServiceMonitor configuration for Prometheus Operator
serviceMonitor:
  # -- Enable ServiceMonitor creation
  enabled: false
  # -- Scrape interval (uses Prometheus default if empty)
  interval: ""
  # -- Additional labels for ServiceMonitor (for Prometheus selector)
  labels: {}

# -- NetworkPolicy configuration
networkPolicy:
  # -- Enable NetworkPolicy for controller pods
  enabled: false

# -- GatewayClass configuration
gatewayClass:
  # -- Create GatewayClass resource
  create: true
